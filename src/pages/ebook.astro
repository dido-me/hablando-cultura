---
export const prerender = true;

import Layout from "../layouts/Layout.astro";
---

<Layout title="10 Pasos para tu Proyecto Cultural | Karolay Ramírez">
    <!-- Header simple con volver -->
    <header class="fixed top-0 left-0 right-0 z-50 bg-white/80 backdrop-blur-md border-b border-slate-100">
        <div class="max-w-7xl mx-auto px-6 lg:px-8">
            <div class="flex justify-between items-center h-20">
                <a class="font-display font-extrabold text-xl tracking-tighter text-slate-900" href="/">
                    KAROLAY RAMÍREZ
                </a>
                <a href="/" class="text-sm font-semibold text-slate-600 hover:text-[var(--primary)] transition-colors flex items-center gap-2">
                    <span class="material-symbols-outlined text-base">arrow_back</span>
                    Volver al inicio
                </a>
            </div>
        </div>
    </header>

    <main class="pt-32 pb-24 bg-white">
        <div class="max-w-6xl mx-auto px-6 lg:px-8">
            <!-- Hero del ebook -->
            <div class="flex flex-col lg:flex-row items-center gap-16 mb-24">
                <div class="w-full lg:w-1/2">
                    <img alt="10 Pasos para tu Proyecto Cultural - Portada" class="w-full max-w-md mx-auto h-auto rounded-2xl shadow-2xl" src="/ebook/1.png" />
                </div>
                <div class="w-full lg:w-1/2 space-y-6">
                    <span class="inline-block px-4 py-1 bg-[var(--secondary)] text-[10px] font-black uppercase tracking-widest rounded-full">Preventa por tiempo limitado</span>
                    <h1 class="font-display text-5xl font-bold text-slate-900 leading-tight">10 Pasos para tu Proyecto Cultural</h1>
                    <p class="text-lg text-slate-600">Empieza hoy mismo con la metodología que he perfeccionado en más de 10 años de carrera en gestión y producción cultural.</p>
                    <ul class="space-y-3 text-slate-600">
                        <li class="flex items-start gap-3">
                            <span class="material-symbols-outlined text-[var(--primary)] mt-0.5">check_circle</span>
                            <span>Metodología probada en proyectos reales</span>
                        </li>
                        <li class="flex items-start gap-3">
                            <span class="material-symbols-outlined text-[var(--primary)] mt-0.5">check_circle</span>
                            <span>Pasos claros y accionables</span>
                        </li>
                        <li class="flex items-start gap-3">
                            <span class="material-symbols-outlined text-[var(--primary)] mt-0.5">check_circle</span>
                            <span>Ideal para gestores culturales y emprendedores</span>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Vista previa del contenido -->
            <div class="mb-24">
                <h2 class="font-display text-3xl font-bold text-slate-900 text-center mb-12">Vista previa</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <a href="/ebook/1.png" class="glightbox cursor-zoom-in" data-gallery="ebook-preview" data-description="Página 1">
                        <img alt="Ebook página 1" class="w-full h-auto rounded-xl shadow-lg hover:shadow-2xl transition-shadow" src="/ebook/1.png" />
                    </a>
                    <a href="/ebook/2.png" class="glightbox cursor-zoom-in" data-gallery="ebook-preview" data-description="Página 2">
                        <img alt="Ebook página 2" class="w-full h-auto rounded-xl shadow-lg hover:shadow-2xl transition-shadow" src="/ebook/2.png" />
                    </a>
                    <a href="/ebook/3.png" class="glightbox cursor-zoom-in" data-gallery="ebook-preview" data-description="Página 3">
                        <img alt="Ebook página 3" class="w-full h-auto rounded-xl shadow-lg hover:shadow-2xl transition-shadow" src="/ebook/3.png" />
                    </a>
                </div>
            </div>

            <!-- Formulario de descarga -->
            <div class="max-w-xl mx-auto">
                <div class="bg-purple-50 rounded-3xl p-8 lg:p-12 space-y-8">
                    <div class="text-center">
                        <h2 class="font-display text-3xl font-bold text-slate-900 mb-3">Obtén tu ebook</h2>
                        <p class="text-slate-600">Ingresa tus datos y te enviaremos el ebook a tu correo.</p>
                    </div>
                    <form id="ebook-form" class="space-y-4">
                        <input name="name" required class="w-full px-6 py-4 rounded-full border-slate-200 focus:ring-[var(--primary)] focus:border-[var(--primary)]" placeholder="Tu nombre" type="text" />
                        <input name="email" required class="w-full px-6 py-4 rounded-full border-slate-200 focus:ring-[var(--primary)] focus:border-[var(--primary)]" placeholder="Tu email" type="email" />
                        <label class="flex items-center gap-3 cursor-pointer">
                            <input name="whatsapp" class="rounded text-[var(--primary)] focus:ring-[var(--primary)]" type="checkbox" />
                            <span class="text-sm text-slate-500">Deseo unirme a la comunidad de WhatsApp</span>
                        </label>
                        <button id="ebook-btn" disabled class="w-full px-8 py-4 bg-[var(--primary)] text-white font-bold rounded-full shadow-lg hover:bg-purple-800 transition-all disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-[var(--primary)]" type="submit">
                            Obtener libro
                        </button>
                        <p id="ebook-message" class="text-center text-sm hidden"></p>
                    </form>
                    <div class="flex items-center justify-center gap-4 text-xs font-semibold text-slate-400">
                        <span>Aceptamos:</span>
                        <div class="flex gap-3 items-center">
                            <img src="/pagos/yape.png" alt="Yape" class="h-8" />
                            <img src="/pagos/plin.png" alt="Plin" class="h-8" />
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <script>
        import GLightbox from "glightbox";
        import "glightbox/dist/css/glightbox.min.css";

        GLightbox({
            selector: ".glightbox",
            touchNavigation: true,
            loop: true,
            zoomable: true,
            draggable: true,
        });

        const form = document.getElementById("ebook-form") as HTMLFormElement;
        const btn = document.getElementById("ebook-btn") as HTMLButtonElement;
        const msg = document.getElementById("ebook-message") as HTMLParagraphElement;
        const nameInput = form.querySelector('input[name="name"]') as HTMLInputElement;
        const emailInput = form.querySelector('input[name="email"]') as HTMLInputElement;
        const whatsappCheck = form.querySelector('input[name="whatsapp"]') as HTMLInputElement;

        function validateForm() {
            const nameOk = nameInput.value.trim().length > 0;
            const emailOk = emailInput.value.trim().length > 0 && emailInput.validity.valid;
            btn.disabled = !(nameOk && emailOk);
        }

        nameInput.addEventListener("input", validateForm);
        emailInput.addEventListener("input", validateForm);

        form.addEventListener("submit", async (e) => {
            e.preventDefault();
            const formData = new FormData(form);
            const name = formData.get("name") as string;
            const email = formData.get("email") as string;
            const whatsapp = whatsappCheck.checked;

            btn.disabled = true;
            btn.textContent = "Enviando...";
            msg.classList.add("hidden");

            try {
                const res = await fetch("/api/ebook", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ name, email, whatsapp }),
                });
                const data = await res.json();

                if (res.ok) {
                    msg.textContent = "¡Revisa tu correo! Te hemos enviado el ebook.";
                    msg.className = "text-center text-sm text-green-600 font-semibold";

                    if (whatsapp) {
                        const waUrl = import.meta.env.PUBLIC_WHATSAPP_GROUP_URL;
                        if (waUrl) window.open(waUrl, "_blank");
                    }

                    form.reset();
                } else {
                    msg.textContent = data.error || "Ocurrió un error. Intenta de nuevo.";
                    msg.className = "text-center text-sm text-red-600 font-semibold";
                }
            } catch {
                msg.textContent = "Error de conexión. Intenta de nuevo.";
                msg.className = "text-center text-sm text-red-600 font-semibold";
            } finally {
                btn.disabled = false;
                btn.textContent = "Obtener libro";
                validateForm();
            }
        });
    </script>
</Layout>
